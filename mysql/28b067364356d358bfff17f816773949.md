# InnoDB的事务实现机制

## 数据库的事务

数据库的事务具有ACID四个特征：

- A(Atomicity):原子性，整个数据库事务是不可分割的工作单位，只有事务中的所有的数据库操作都执行成功，才算整个事务成功。事务中任何一个SQL执行失败，已经执行成功的SQL语句也必须撤销，回到执行事务的之前的状态。

- C(Consistent):一致性，是指事务将数据库从一种一致性状态变为下一种一致性状态。在事务开始之前和之后，数据库的完整性约束没有被破坏。

- I(Isolation):隔离性，隔离性要求每个读写事务对其他事务的操作对象能相互分离。

- D(Durability):持久性，持久性指事务一旦提交，其结果就是永久性的。

## 更新丢失，脏读，幻读与不可重复读

- 更新丢失(Lost Update)：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题 —— 最后的更新覆盖了其他事务所做的更新。

- 脏读(Dirty Reads)：一个事务正在对一条记录做修改，在这个事务并提交前，这条记录的数据就处于不一致状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些尚未提交的脏数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象地叫做"脏读"

- 不可重复读(Non-Repeatable Reads)：一个事务再次读取某些数据已经发生了改变、或某些记录已经被删除了！这种现象叫做"不可重复读"。

- 幻读(Phantom Reads)：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为"幻读"。